<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sticky Observer Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            gap: 20px;
            height: 100vh;
            box-sizing: border-box;
            background-color: #f9fafb;
        }

        /* Layout */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 600px;
            max-height: 600px;
        }

        .logger-panel {
            flex: 1;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .logger-header {
            background: #1f2937;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #log-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-family: monospace;
            font-size: 13px;
            background: #111827; /* Dark terminal look */
            color: #d1d5db;
        }

        /* Scroller Area */
        .scroller {
            height: 100%;
            overflow-y: auto;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            position: relative; /* Required context for the observer */
            scroll-behavior: smooth;
        }

        /* Sections */
        .section {
            /* * IMPORTANT: The library automatically sets position: relative on the parent 
             * of sticky elements if missing, but it's good practice to add it explicitly.
             * This ensures the absolute sentinels are positioned correctly within the section.
             */
            position: relative; 
            min-height: 400px;
            border-bottom: 1px solid #eee;
            margin-bottom: 1em;
        }

        .section:nth-child(even) {
            background-color: #fafafa;
        }

        /* Sticky Headers */
        .sticky-header {
            position: sticky;
            top: 0;
            background-color: #fff;
            padding: 15px 20px;
            margin: 0;
            border-bottom: 2px solid #3b82f6;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: background-color 0.2s, color 0.2s;
        }

        /* Visual feedback when stuck (toggled by library) */
        .sticky-header.is-stuck {
            background-color: #3b82f6;
            color: white;
            border-bottom-color: #1d4ed8;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .content {
            padding: 20px;
            line-height: 1.6;
            color: #4b5563;
        }

        /* Log Item Styling */
        .log-entry {
            margin-bottom: 6px;
            padding-left: 10px;
            border-left: 3px solid transparent;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }
        .log-entry.stuck { border-left-color: #10b981; color: #a7f3d0; } /* Green */
        .log-entry.unstuck { border-left-color: #ef4444; color: #fca5a5; } /* Red */
        
        .timestamp { color: #6b7280; margin-right: 8px; }

        @keyframes fadeIn { to { opacity: 1; } }

        button.clear-btn {
            background: #374151;
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        button.clear-btn:hover { background: #4b5563; }

    </style>
</head>
<body>

    <!-- Main Content Area -->
    <div class="container">
        <h2>Sticky Observer Demo</h2>
        <div id="scroller" class="scroller">
            
            <div class="section">
                <h2 class="sticky-header">1. Introduction</h2>
                <div class="content">
                    <p>Scroll down to see the sticky behavior. As this header hits the top, it will turn blue and an event will be logged.</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                    <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
                    <div style="height: 100px; background: #f3f4f6; margin: 10px 0; border-radius: 4px;"></div>
                    <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                </div>
            </div>

            <div class="section">
                <h2 class="sticky-header">2. Features</h2>
                <div class="content">
                    <p>This is the second section. Watch the "Introduction" header unstick as this one pushes it up (or simply slides over/under depending on layout).</p>
                    <p>Because these are separate sections, the library tracks them independently.</p>
                    <div style="height: 200px; background: #e5e7eb; margin: 10px 0; border-radius: 4px;"></div>
                    <p>Keep scrolling...</p>
                    <div style="height: 200px; background: #e5e7eb; margin: 10px 0; border-radius: 4px;"></div>
                </div>
            </div>

            <div class="section">
                <h2 class="sticky-header">3. Configuration</h2>
                <div class="content">
                    <p>The library uses sentinels injected into the DOM.</p>
                    <p>With <code>debug: true</code>, you can see them as green (start) and red (end) boxes.</p>
                    <p>Lorem ipsum dolor sit amet...</p>
                    <div style="height: 150px; background: #d1d5db; margin: 10px 0; border-radius: 4px;"></div>
                </div>
            </div>

            <div class="section">
                <h2 class="sticky-header">4. Conclusion</h2>
                <div class="content">
                    <p>Final section. When the bottom of this section passes the viewport top, this header will also unstick (unless <code>keepStickyAtBottom</code> is true).</p>
                    <p>End of content.</p>
                    <div style="height: 300px; background: #9ca3af; margin: 10px 0; border-radius: 4px;"></div>
                </div>
            </div>

        </div>
    </div>

    <!-- Logger Panel -->
    <div class="logger-panel">
        <div class="logger-header">
            <span>Event Log</span>
            <button class="clear-btn" onclick="document.getElementById('log-container').innerHTML = ''">Clear</button>
        </div>
        <div id="log-container">
            <div style="color: #6b7280; padding: 10px;">Waiting for events...</div>
        </div>
    </div>

    <script type="module">
        import { StickyObserver } from './sticky-observer.js';
        
        const logger = document.getElementById('log-container');

        const observer = StickyObserver.observe('.sticky-header', { 
            container: document.getElementById('scroller'), 
            debug: true, // Set to false to hide the red/green boxes
            keepStickyAtBottom: false
        });

        observer.addEventListener('sticky-change', (e) => {
            const { target, stuck } = e.detail;
            const now = new Date().toLocaleTimeString();
            const text = target.innerText.trim();

            const entry = document.createElement('div');
            entry.className = `log-entry ${stuck ? 'stuck' : 'unstuck'}`;
            entry.innerHTML = `<span class="timestamp">[${now}]</span> <strong>${text}</strong> is ${stuck ? 'STUCK' : 'UNSTUCK'}`;
            
            // Prepend log
            logger.insertBefore(entry, logger.firstChild);
        });
    </script>
</body>
</html>